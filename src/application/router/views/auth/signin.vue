<template>
	<Auth>
		<div>
			<h2 class="text-center">Sign In</h2>
			<p class="small mb-4 text-center">Sign in to gain authorization access to restricted content.</p>
			<form @submit.prevent="emailLogin">
				<div class="form-group">
					<input type="email" id="email" class="form-control" placeholder="Email address" v-model="emailFactory.email"
						:class="{'is-invalid': emailFactory.errors.email, 'is-valid': emailFactory.isValid('email')}" autocomplete="email">
					<span class="small text-danger" v-if="emailFactory.errors.email">{{ emailFactory.errors.email }}</span>
				</div>
				<div class="form-group">
					<input type="password" id="password" class="form-control" placeholder="Password" v-model="emailFactory.password"
						:class="{'is-invalid': emailFactory.errors.password, 'is-valid': emailFactory.isValid('password')}" autocomplete="password">
					<span class="small text-danger" v-if="emailFactory.errors.password">{{ emailFactory.errors.password }}</span>
				</div>
				<div class="d-flex flex-column">
					<button class="btn btn-gold text-white" type="submit" :disabled="anyLoading || !emailFactory.valid">
						<loading class="mr-1" v-if="emailLoading" />
						<span>Sign In with email</span>
					</button>
				</div>
				<div class="d-flex justify-content-between text-wrap align-items-center small mt-2">
					<span class="mr-2">
						Don't have an account?
						<router-link class="text-info" to="/auth/signup">Sign Up</router-link>
					</span>
					<span>
						Forgot Password?
						<router-link class="text-info" to="/auth/forgot-password">Retrieve Now</router-link>
					</span>
				</div>
			</form>
			<p class="text-center small text-muted mt-4 mb-2">Or sign in with other options</p>
			<div class="form-group d-flex flex-column mb-3">
				<button @click="googleLogin" class="btn btn-danger" :disabled="anyLoading">
					<loading class="mr-1" v-if="googleLoading"/>
					<i class="fab fa-google mr-2" v-else></i>
					Sign In with Google
				</button>
			</div>
			<div v-if="isDev" class="my-4">
				<div class="d-flex justify-content-center">
					<span class="mr-2" v-for="dev in devs" :key="dev">
						<input type="radio" v-model="devId" :value="dev" class="mr-1">
						<label class="text-capitalize">{{ dev }}</label>
					</span>
				</div>
				<button @click="devLogin" :disabled="!devId" class="btn btn-info w-100">
					<loading class="mr-1" v-if="devLoading" />
					<i class="fas fa-user-cog text-white mr-2" v-else></i>
					Sign In as dev user
				</button>
			</div>
		</div>
	</Auth>
</template>

<script lang="ts">
import { defineComponent, computed } from '@vue/composition-api'
import { useDevLogin, useGoogleLogin, useLoginForm } from '@application/usecases/users/auth'
export default defineComponent({
	name: 'Signin',
	setup(){
		const { loading: emailLoading, login: emailLogin, factory: emailFactory } = useLoginForm()
		const { loading: googleLoading, login: googleLogin } = useGoogleLogin()
		const { loading: devLoading, login: devLogin, id: devId, devs, isDev } = useDevLogin()
		return {
			emailLoading, emailLogin, emailFactory,
			googleLoading, googleLogin,
			devLoading, devLogin, devId, devs, isDev,
			anyLoading: computed(() => emailLoading.value || devLoading.value || googleLoading.value),
		}
	},
	meta(){
		return {
			title: 'Sign In',
			meta: [
				{
					vmid: 'robots',
					name: 'robots',
					content: 'none'
				}
			]
		}
	}
})
</script>

<style lang="scss" scoped>
input{
	padding: 1rem;
	max-width: 700px;
}
.form-group{
	margin: 1rem 0;
}
</style>
