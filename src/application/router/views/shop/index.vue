<template>
	<Default>
		<helper-spinner v-if="loading"/>
		<div v-else class="my-3">
			<helper-message message="No notes currently in the shop. Check again later" v-if="notes.length === 0" />
			<div class="container" v-else>
				<note-card v-for="note in notes" :key="note.id" :note="note" />
				<div class="d-flex justify-content-end my-3" v-if="hasMore">
					<button class="btn-success" @click="fetchOlderNotes">
						<i class="fas fa-spinner fa-spin mr-2" v-if="olderNotesLoading"></i>
						<span>Fetch More</span>
					</button>
				</div>
			</div>
			<button class="floating-button" @click="setCartModalOverview" v-if="getCartLength"><i class="fas fa-shopping-basket"></i></button>
		</div>
	</Default>
</template>

<script lang="ts">
	import { computed, defineComponent } from '@vue/composition-api'
	import store from '@/store'
	import NoteCard from '@/components/shop/list/NoteCard.vue'
	import { useNotesList } from '@/usecases/shop/useNotes'
	export default defineComponent({
		name: 'Shop',
		setup(){
			const { loading, error, notes, hasMore, olderNotesLoading, fetchOlderNotes } = useNotesList()
			return {
				loading, error, notes,
				hasMore, olderNotesLoading, fetchOlderNotes,
				getCartLength: computed(() => store.getters.getCartLength),
				setCartModalOverview: () => store.dispatch('setCartModalOverview')
			}
		},
		components: {
			'note-card': NoteCard
		},
		meta(){
			return {
				title: 'Shop on Stranerd',
				meta: [
					{
						vmid: 'description',
						name: 'description',
						content: ''
					},
					{
						vmid: 'keywords',
						name: 'keywords',
						content: [].join(', ')
					}
				]
			}
		}
	})
</script>
